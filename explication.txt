================================================================================
                    BIBLIO-POCHE - EXPLICATION DU PROJET
================================================================================

Ce document decrit chaque fichier du projet Biblio-Poche, une application web
de librairie en ligne composee d'un backend Node.js/Express et d'un frontend React.

================================================================================
                           STRUCTURE DU PROJET
================================================================================

biblio-poche/
├── backend/                    # API REST Node.js
│   ├── middleware/             # Middleware d'authentification
│   ├── models/                 # Modeles de donnees MongoDB
│   ├── routes/                 # Routes de l'API
│   ├── security-tests/         # Scripts de tests de securite
│   ├── .env                    # Variables d'environnement
│   ├── package.json            # Dependances backend
│   ├── seed.js                 # Script de peuplement de la base
│   ├── server.js               # Point d'entree du serveur
│   └── swagger.json            # Documentation API
├── frontend/                   # Application React
│   ├── public/                 # Fichiers statiques
│   ├── src/                    # Code source React
│   │   ├── components/         # Composants reutilisables
│   │   ├── pages/              # Pages de l'application
│   │   └── ...
│   └── package.json            # Dependances frontend
└── package.json                # Configuration racine

================================================================================
                         FICHIERS RACINE
================================================================================

./package.json
--------------
Fichier de configuration npm a la racine du projet.
Contient une seule dependance : "escape-html" (version ^1.0.3) utilisee pour
la securite contre les attaques XSS en echappant les caracteres HTML speciaux.

================================================================================
                         BACKEND - CONFIGURATION
================================================================================

backend/package.json
--------------------
Fichier de configuration du backend Node.js. Definit les dependances :
- axios (^1.13.2) : Client HTTP pour les requetes externes
- bcryptjs (^3.0.3) : Hashage securise des mots de passe
- cors (^2.8.5) : Gestion des Cross-Origin Resource Sharing
- dotenv (^17.2.3) : Chargement des variables d'environnement
- express (^5.2.1) : Framework web Node.js
- express-mongo-sanitize (^2.2.0) : Protection contre les injections NoSQL
- express-rate-limit (^8.2.1) : Limitation du nombre de requetes
- helmet (^8.1.0) : Securisation des en-tetes HTTP
- jsonwebtoken (^9.0.3) : Generation et verification des tokens JWT
- mongoose (^9.0.0) : ODM pour MongoDB
- swagger-ui-express (^5.0.1) : Documentation API interactive
- xss (^1.0.15) : Protection contre les attaques XSS

backend/.env
------------
Fichier de configuration des variables d'environnement :
- PORT=5000 : Port d'ecoute du serveur
- MONGO_URI=mongodb://127.0.0.1:27017/biblio-poche : URI de connexion MongoDB
- JWT_SECRET : Cle secrete pour signer les tokens JWT

backend/server.js
-----------------
Point d'entree principal du serveur backend. Ce fichier :
1. Configure la securite avec Helmet (protection des en-tetes HTTP)
2. Applique le rate limiting (10000 requetes max par 15 minutes par IP)
3. Configure CORS pour autoriser les requetes cross-origin
4. Se connecte a la base de donnees MongoDB
5. Monte toutes les routes de l'API :
   - /api/books : Gestion des livres
   - /api/ai : Recommandations intelligentes
   - /api/auth : Authentification (login/register)
   - /api/orders : Gestion des commandes
   - /api/users : Gestion du profil utilisateur
   - /api/payments : Gestion des paiements
   - /api/admin : Routes d'administration
6. Configure Swagger UI sur /api-docs pour la documentation

backend/swagger.json
--------------------
Documentation OpenAPI 3.0 de l'API. Decrit les endpoints disponibles avec
leurs parametres et reponses. Actuellement configure pour le serveur de
developpement (localhost:5000). Contient la documentation de base pour
l'endpoint GET /api/books.

================================================================================
                         BACKEND - MODELES (MongoDB)
================================================================================

backend/models/Book.js
----------------------
Modele Mongoose pour les livres. Schema :
- title (String, requis) : Titre du livre
- author (String, requis) : Auteur
- price (Number, requis) : Prix en euros
- category (String, requis) : Categorie (important pour les recommandations IA)
- description (String) : Description du livre
- image (String) : URL de l'image de couverture
- stock (Number, defaut: 10) : Quantite en stock
- rating (Number, defaut: 0) : Note moyenne
- numReviews (Number, defaut: 0) : Nombre d'avis
- reviews (Array) : Liste des avis avec sous-schema :
  - user (ObjectId ref User) : Utilisateur qui a laisse l'avis
  - name (String) : Nom de l'utilisateur
  - rating (Number) : Note donnee
  - comment (String) : Commentaire
  - timestamps : Date de creation/modification

backend/models/User.js
----------------------
Modele Mongoose pour les utilisateurs. Schema :
- username (String, unique, requis) : Nom d'utilisateur
- email (String, unique, requis, lowercase, trim) : Adresse email
- password (String, requis) : Mot de passe avec validation de complexite :
  - Minimum 12 caracteres
  - Au moins une majuscule, une minuscule, un chiffre, un caractere special
- role (String, enum: ['user', 'admin'], defaut: 'user') : Role utilisateur
- timestamps : Dates de creation/modification

Fonctionnalites :
- Pre-save hook : Echappe les caracteres HTML dans username/email (protection XSS)
  et hash le mot de passe avec bcrypt (salt de 10)
- Methode comparePassword() : Compare un mot de passe avec le hash stocke
- Transformation toJSON() : Supprime password, __v et remplace _id par id

backend/models/Order.js
-----------------------
Modele Mongoose pour les commandes. Schema :
- user (ObjectId ref User, requis) : Utilisateur proprietaire
- orderItems (Array) : Liste des articles commandes
  - title, qty, image, price, product (ref Book)
- shippingAddress (Object) : Adresse de livraison
  - address, city, postalCode, country
- paymentMethod (String, defaut: 'Carte Bancaire') : Methode de paiement
- totalPrice (Number, defaut: 0) : Prix total
- isPaid (Boolean, defaut: false) : Statut de paiement
- paidAt (Date) : Date de paiement
- isDelivered (Boolean, defaut: false) : Statut de livraison
- status (String, enum: pending/confirmed/shipped/delivered/cancelled)
- payment (ObjectId ref Payment) : Reference au paiement
- createdAt (Date) : Date de creation

backend/models/Payment.js
-------------------------
Modele Mongoose pour les paiements. Schema :
- user (ObjectId ref User, requis) : Utilisateur
- order (ObjectId ref Order, requis) : Commande associee
- amount (Number, requis) : Montant
- paymentMethod (String, enum: card/paypal/bank_transfer, defaut: card)
- status (String, enum: pending/completed/failed/refunded/partially_refunded)
- transactionId (String, unique) : ID de transaction auto-genere
- cardLast4 (String) : 4 derniers chiffres de la carte
- refundedAmount (Number, defaut: 0) : Montant rembourse
- refundReason (String) : Raison du remboursement
- metadata (Object) : Donnees supplementaires
- timestamps : Dates de creation/modification

Pre-save hook : Genere automatiquement un transactionId unique (TXN_timestamp_random)

================================================================================
                         BACKEND - MIDDLEWARE
================================================================================

backend/middleware/auth.js
--------------------------
Middleware d'authentification pour les routes protegees.
Fonctionnement :
1. Verifie la presence du header Authorization avec format "Bearer <token>"
2. Extrait et verifie le token JWT avec la cle secrete
3. Decode le payload et ajoute req.user = { id, role }
4. Appelle next() si valide, sinon retourne erreur 401

backend/middleware/admin.js
---------------------------
Middleware d'autorisation pour les routes administrateur.
Fonctionnement :
1. Memes verifications que auth.js
2. Verifie en plus que decoded.role === 'admin'
3. Retourne erreur 403 si l'utilisateur n'est pas admin

================================================================================
                         BACKEND - ROUTES
================================================================================

backend/routes/authRoutes.js
----------------------------
Routes d'authentification (/api/auth) :

POST /register :
- Cree un nouveau compte utilisateur
- Verifie les champs requis (username, email, password)
- Verifie que l'email n'existe pas deja
- Cree l'utilisateur et genere un token JWT (expire en 7 jours)
- Retourne le token et les infos utilisateur

POST /login :
- Authentifie un utilisateur existant
- Verifie les identifiants avec comparePassword()
- Genere un token JWT si valide
- Retourne le token et les infos utilisateur

backend/routes/bookRoutes.js
----------------------------
Routes de gestion des livres (/api/books) :

GET / :
- Recupere tous les livres
- Filtre optionnel par categorie (?category=...)
- Retourne un tableau de livres

GET /:id :
- Recupere un livre par son ID
- Populate les reviews avec les noms d'utilisateurs
- Retourne 404 si non trouve

POST / :
- Ajoute un nouveau livre
- Nettoie les champs texte avec xss() contre les attaques XSS
- Retourne le livre cree (201)

POST /:id/reviews (authentifie) :
- Ajoute un avis sur un livre
- Verifie que l'utilisateur n'a pas deja commente
- Calcule la nouvelle note moyenne
- Retourne le livre mis a jour

backend/routes/orderRoutes.js
-----------------------------
Routes de gestion des commandes (/api/orders) :

POST /orders (authentifie) :
- Cree une nouvelle commande
- Verifie les stocks avant creation
- Decremente les stocks apres creation
- Simule le paiement (isPaid = true)
- Retourne la commande creee

GET /myorders (authentifie) :
- Recupere les commandes de l'utilisateur connecte
- Filtre par user: req.user.id

GET /:id (authentifie) :
- Recupere une commande par ID
- Verifie que l'utilisateur est proprietaire
- Retourne 403 si acces non autorise

PUT /:id (authentifie) :
- Modifie l'adresse de livraison
- Impossible si commande expediee/livree/annulee
- Verifie la propriete de la commande

PUT /:id/cancel (authentifie) :
- Annule une commande
- Remet les articles en stock
- Impossible si deja expediee/livree

backend/routes/userRoutes.js
----------------------------
Routes de gestion du profil (/api/users) :

PUT /profile (authentifie) :
- Met a jour username, email, et/ou password
- Hash le nouveau mot de passe si fourni
- Gere les erreurs de duplication (email/username deja pris)

DELETE /profile (authentifie) :
- Supprime le compte de l'utilisateur connecte
- Suppression irreversible

backend/routes/paymentRoutes.js
-------------------------------
Routes de gestion des paiements (/api/payments) :

POST / (authentifie) :
- Cree un paiement pour une commande
- Verifie la propriete de la commande
- Empeche les paiements doubles
- Simule un paiement reussi (toujours OK en dev)
- Met a jour isPaid/paidAt sur la commande

GET / (authentifie) :
- Liste tous les paiements de l'utilisateur
- Populate les infos de commande
- Trie par date decroissante

GET /stats/summary (authentifie) :
- Resume des paiements : total, depense, completes, rembourses

GET /transaction/:transactionId (authentifie) :
- Recupere un paiement par ID de transaction

GET /:id (authentifie) :
- Recupere un paiement par ID MongoDB

POST /:id/refund (authentifie) :
- Demande un remboursement (total ou partiel)
- Verifie que le paiement est completed
- Met a jour le statut de la commande si rembourse totalement

backend/routes/aiRoutes.js
--------------------------
Routes du moteur de recommandation (/api/ai) :

POST /recommend :
- Genere des recommandations basees sur le panier
- Utilise un systeme de scoring avec poids :
  - CATEGORY_MATCH (10) : Meme categorie que le panier
  - ASSOCIATED_CATEGORY (7) : Categorie associee (ex: SF -> Fantasy)
  - HIGH_RATING (5) : Livre bien note (>= 4 etoiles)
  - POPULAR (3) : Livre populaire (>= 10 avis)
  - PRICE_SIMILARITY (2) : Prix proche de la moyenne du panier
  - SAME_AUTHOR (8) : Meme auteur
  - PREVIOUSLY_BOUGHT_CATEGORY (6) : Categorie deja achetee
- Retourne les 5 meilleurs candidats

GET /personalized (authentifie) :
- Recommandations basees sur l'historique d'achat
- Analyse les categories et auteurs preferes
- Retourne les best-sellers si pas d'historique

GET /also-bought/:bookId :
- "Les clients ont aussi achete"
- Analyse les co-achats dans les commandes passees
- Complete avec des livres similaires si necessaire

GET /trending :
- Livres tendance des 30 derniers jours
- Base sur les ventes recentes
- Complete avec les mieux notes si pas assez de donnees

backend/routes/adminRoutes.js
-----------------------------
Routes d'administration (/api/admin) - toutes protegees par middleware admin :

POST /setup-admin :
- Cree le premier compte admin (non protege mais necessite cle secrete)
- Cle par defaut : BIBLIO_ADMIN_SECRET_2024

POST /create-admin (admin) :
- Cree un nouveau compte admin par un admin existant

GET /books, POST /books, PUT /books/:id, DELETE /books/:id (admin) :
- CRUD complet sur les livres avec pagination
- Sanitization XSS sur les champs texte

GET /orders, GET /orders/:id, PUT /orders/:id, DELETE /orders/:id (admin) :
- Gestion des commandes
- Modification du statut (pending/confirmed/shipped/delivered/cancelled)
- Remise en stock automatique si annulation

GET /payments, GET /payments/:id, PUT /payments/:id (admin) :
- Gestion des paiements
- Remboursement admin

GET /users, PUT /users/:id/role, DELETE /users/:id (admin) :
- Gestion des utilisateurs
- Modification des roles
- Impossible de supprimer son propre compte

GET /stats (admin) :
- Dashboard avec statistiques :
  - Totaux (livres, commandes, utilisateurs, paiements, revenus)
  - Commandes des 7 derniers jours
  - Livres en rupture de stock
  - Commandes par statut
  - Top 5 des ventes

================================================================================
                         BACKEND - UTILITAIRES
================================================================================

backend/seed.js
---------------
Script de peuplement de la base de donnees.
- Se connecte a MongoDB
- Supprime tous les livres existants
- Insere 15 livres de demonstration dans differentes categories :
  - Science-Fiction : Dune, Fondation, Neuromancien
  - Policier : Le Chien des Baskerville, Ils etaient dix, Le Silence des Agneaux
  - Roman : Le Petit Prince, Normal People, L'Etranger
  - Manga : One Piece, Naruto, Dragon Ball
  - Fantasy : Harry Potter, Le Seigneur des Anneaux, Le Sorceleur
- Chaque livre a : titre, auteur, prix, categorie, description, image URL, stock

Usage : node seed.js

backend/security-tests/scan.js
------------------------------
Script de tests de securite non-destructifs.
Verifie :
1. Atteignabilite du serveur (GET /)
2. En-tetes de securite (Helmet/CSP) : x-content-type-options, x-frame-options...
3. Configuration CORS (detection si Access-Control-Allow-Origin: *)
4. Injection NoSQL (test login avec payload objet { "$gt": "" })
5. XSS stocke (POST livre avec <script>, GET pour verifier echappement)
6. Force du JWT_SECRET dans .env
7. Exposition de la documentation Swagger

Usage : node scan.js (serveur doit etre demarre)

================================================================================
                         FRONTEND - CONFIGURATION
================================================================================

frontend/package.json
---------------------
Configuration du frontend React. Dependances principales :
- react (^19.2.0) et react-dom : Framework UI
- react-router-dom (^7.10.0) : Routage SPA
- axios (^1.13.2) : Requetes HTTP
- leaflet (^1.9.4) et react-leaflet (^5.0.0) : Cartes interactives
- @testing-library/* : Tests unitaires

Scripts npm :
- start : Lance le serveur de developpement
- build : Compile pour la production
- test : Execute les tests

frontend/public/index.html
--------------------------
Template HTML principal de l'application React.
- Contient la div #root ou React monte l'application
- Inclut les meta tags de base
- Lie le manifest.json pour les PWA

frontend/public/manifest.json
-----------------------------
Manifeste de l'application web progressive (PWA).
Definit : nom court/long, icones, couleur de theme, mode d'affichage standalone.

================================================================================
                         FRONTEND - FICHIERS SOURCES
================================================================================

frontend/src/index.js
---------------------
Point d'entree du frontend React.
- Cree le root React dans #root
- Rend le composant App dans React.StrictMode
- Appelle reportWebVitals() pour les metriques de performance

frontend/src/index.css
----------------------
Styles CSS globaux.
- Reset du margin sur body
- Police systeme par defaut (system-ui, -apple-system, etc.)
- Police monospace pour les blocs de code

frontend/src/App.css
--------------------
Styles CSS specifiques a l'application (principalement du template Create React App).
- Classes pour le logo anime, header, liens

frontend/src/App.js
-------------------
Composant principal de l'application. Gere :

1. PANIER (State + LocalStorage) :
   - Charge le panier depuis localStorage('biblio-cart')
   - Fonctions : addToCart(), removeFromCart(), clearCart()
   - Sauvegarde automatique a chaque modification

2. UTILISATEUR :
   - State user charge depuis localStorage('user')
   - Fonction logout() : supprime token/user et redirige

3. NAVIGATION :
   - Barre de navigation avec logo, liens utilisateur, panier
   - Affichage conditionnel selon role (user/admin)
   - Badge compteur sur l'icone panier

4. ROUTING :
   - / : Home (catalogue) ou Admin si admin
   - /cart : Panier
   - /book/:id : Details d'un livre
   - /login, /register : Authentification
   - /myorders : Mes commandes
   - /profile : Mon profil
   - /payments : Mes paiements
   - /checkout : Validation de commande
   - /admin : Tableau de bord admin (protege)

5. CONTROLE D'ACCES :
   - Les admins sont rediriges vers leur dashboard
   - Les routes sensibles sont protegees cote frontend

frontend/src/reportWebVitals.js
-------------------------------
Fonction pour mesurer les performances web (Core Web Vitals) :
- CLS (Cumulative Layout Shift)
- FID (First Input Delay)
- FCP (First Contentful Paint)
- LCP (Largest Contentful Paint)
- TTFB (Time to First Byte)

frontend/src/setupTests.js
--------------------------
Configuration des tests Jest.
Importe @testing-library/jest-dom pour les matchers de test DOM personnalises.

frontend/src/App.test.js
------------------------
Test unitaire de base (template Create React App).
Verifie que le composant App se rend sans erreur.

================================================================================
                         FRONTEND - PAGES
================================================================================

frontend/src/pages/Home.js
--------------------------
Page d'accueil / Catalogue de livres.
Fonctionnalites :
- Affiche tous les livres depuis l'API
- Barre de filtres par categorie (Tous, SF, Policier, Roman, Manga, Fantasy)
- Grille de cartes avec : image, titre, lien details, auteur, prix, stock
- Bouton "Ajouter au panier" sur chaque carte

frontend/src/pages/BookDetails.js
---------------------------------
Page de details d'un livre.
Fonctionnalites :
- Affiche image grande, titre, auteur, categorie, description, prix
- Section avis des lecteurs avec notes en etoiles
- Formulaire pour laisser un avis (si connecte)
- Section "Les clients ont aussi achete" (recommandations IA)
- Bouton "Ajouter au panier"

frontend/src/pages/Cart.js
--------------------------
Page du panier d'achat.
Fonctionnalites :
- Liste des articles avec image, titre, quantite, prix
- Bouton supprimer par article
- Recapitulatif avec sous-total
- Bouton "Obtenir des recommandations" (appel IA)
- Affichage des livres recommandes
- Composant MapLocator pour choisir un point de retrait
- Bouton "Passer la commande" (redirige vers checkout si connecte)

frontend/src/pages/Checkout.js
------------------------------
Page de validation de commande en 3 etapes :

Etape 1 - Adresse :
- Formulaire adresse de livraison
- Validation des champs requis

Etape 2 - Paiement :
- Apercu visuel de la carte bancaire
- Formulaire : numero de carte, nom, date expiration, CVV
- Validation du format
- Simulation du paiement (toujours reussi)

Etape 3 - Confirmation :
- Message de succes
- Resume de la commande
- Liens vers mes commandes / continuer les achats
- Vide le panier

Barre de progression visuelle entre les etapes.

frontend/src/pages/Login.js
---------------------------
Page de connexion.
- Formulaire email + mot de passe
- Appel POST /api/auth/login
- Sauvegarde token et user dans localStorage
- Redirection vers l'accueil apres connexion
- Lien vers la page d'inscription

frontend/src/pages/Register.js
------------------------------
Page d'inscription.
- Formulaire : username, email, mot de passe, confirmation
- Validation de la complexite du mot de passe cote client :
  - Minimum 12 caracteres
  - Au moins 3 criteres parmi : majuscule, minuscule, chiffre, special
- Appel POST /api/auth/register
- Connexion automatique apres inscription

frontend/src/pages/MyOrders.js
------------------------------
Page "Mes Commandes".
- Liste toutes les commandes de l'utilisateur
- Affichage par commande : ID, date, prix total, statut colore
- Liste des articles avec liens vers les livres
- Adresse de livraison
- Actions (si commande modifiable) :
  - Modifier l'adresse (formulaire inline)
  - Annuler la commande

frontend/src/pages/Profile.js
-----------------------------
Page "Mon Profil".
- Formulaire de modification : username, email, nouveau mot de passe
- Validation de la complexite du nouveau mot de passe
- Bouton "Supprimer mon compte" avec confirmation

frontend/src/pages/Payments.js
------------------------------
Page "Mes Paiements".
- Resume en haut : total transactions, depense, reussis, rembourse
- Liste des paiements avec :
  - ID transaction, montant, statut colore, date
  - Methode de paiement, 4 derniers chiffres carte
  - Reference commande
  - Montant/raison rembourse si applicable
- Bouton "Demander un remboursement" sur paiements completes

frontend/src/pages/Admin.js
---------------------------
Tableau de bord administrateur.
Onglets :

1. Dashboard :
   - Statistiques : livres, commandes, utilisateurs, revenus, commandes 7j, ruptures
   - Top 5 des ventes

2. Livres :
   - Tableau avec titre, auteur, prix, stock
   - Boutons Modifier/Supprimer
   - Modal d'ajout/edition de livre

3. Commandes :
   - Tableau avec ID, client, total, statut (select modifiable), date
   - Bouton Supprimer

4. Paiements :
   - Tableau avec transaction, client, montant, statut, date
   - Bouton Rembourser

5. Utilisateurs :
   - Tableau avec username, email, role (select modifiable), date inscription
   - Bouton Supprimer (sauf admins)

================================================================================
                         FRONTEND - COMPOSANTS
================================================================================

frontend/src/components/MapLocator.js
-------------------------------------
Composant de carte interactive pour choisir un point de retrait.
Utilise Leaflet et React-Leaflet.

Fonctionnalites :
- Carte centree sur la France par defaut
- Liste de 4 magasins fictifs (Paris, Lyon, Marseille, Bordeaux)
- Marqueurs cliquables avec popup contenant nom, adresse, bouton "Choisir"
- Bouton "Me localiser" utilisant l'API Geolocation du navigateur
- Marqueur special pour la position de l'utilisateur
- Composant ChangeView pour mettre a jour la vue dynamiquement

================================================================================
                         ARCHITECTURE GLOBALE
================================================================================

FLUX DE DONNEES :
1. L'utilisateur interagit avec le frontend React
2. React fait des appels HTTP a l'API backend via axios
3. Le backend valide les requetes (auth, admin middleware)
4. Mongoose communique avec MongoDB
5. Les reponses remontent au frontend pour mise a jour de l'UI

SECURITE :
- Authentification par JWT (tokens valides 7 jours)
- Hashage des mots de passe avec bcrypt (salt 10)
- Protection XSS avec echappement des entrees utilisateur
- Rate limiting (10000 req/15min)
- En-tetes securises avec Helmet
- Validation des roles (user/admin)
- Verification de propriete sur les ressources

FONCTIONNALITES PRINCIPALES :
- Catalogue de livres avec filtres
- Panier persistant (localStorage)
- Systeme de commandes avec gestion des stocks
- Paiements simules avec remboursements
- Systeme d'avis et notes
- Recommandations IA basees sur le comportement
- Geolocalisation des points de retrait
- Interface d'administration complete
- Authentification et gestion de profil

================================================================================
                              FIN DU DOCUMENT
================================================================================
